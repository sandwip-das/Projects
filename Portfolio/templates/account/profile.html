{% extends 'base.html' %}
{% load static %}

{% block title %}My Profile{% endblock %}

{% block content %}
<div
    class="pt-[40px] md:pt-[60px] pb-8 min-h-screen relative bg-gradient-to-br from-[#079992] via-[#3B3B98] to-[#6D214F] flex items-center justify-center">

    <div
        class="glass-card p-6 md:p-8 w-full max-w-2xl mx-4 relative z-10 border border-white/10 rounded-2xl shadow-2xl">

        <form method="POST" action="{% url 'edit_profile' %}" enctype="multipart/form-data" class="w-full mx-auto">
            {% csrf_token %}

            <!-- Header: Profile picture and Heading on same line -->
            <div class="flex items-center gap-6 mb-2 border-b border-white/10 pb-2">
                <!-- Profile Picture -->
                <div class="relative group shrink-0">
                    {% if user.profile.profile_picture and user.profile.profile_picture.name != 'default_profile.png' %}
                    <img src="{{ user.profile.profile_picture.url }}" alt="Profile"
                        class="w-24 h-24 rounded-full object-cover border-4 border-[#2ecc71]/50 group-hover:border-[#2ecc71] transition-colors">
                    {% else %}
                    <div
                        class="w-24 h-24 rounded-full bg-gradient-to-br from-[#2ecc71] to-blue-500 flex items-center justify-center text-white font-bold text-3xl border-4 border-[#2ecc71]/50 group-hover:border-[#2ecc71] transition-colors">
                        {% if user.first_name %}{{ user.first_name|make_list|first|upper }}{% else %}{{
                        user.username|make_list|first|upper }}{% endif %}
                    </div>
                    {% endif %}

                    <!-- Overlay upload icon -->
                    <label
                        class="absolute inset-0 bg-black/50 rounded-full flex flex-col items-center justify-center opacity-0 group-hover:opacity-100 transition-opacity cursor-pointer">
                        <i class="fas fa-camera text-white mb-1"></i>
                        <span class="text-white text-[10px] font-bold">Change</span>
                        <input type="file" name="profile_picture" accept="image/*" class="hidden"
                            onchange="previewImage(this)">
                    </label>
                </div>

                <!-- Heading -->
                <div>
                    <h2 class="text-2xl font-extrabold text-white mb-0">Profile Management</h2>
                    <p class="text-gray-400 text-xs text-left">Manage your personal information</p>
                </div>
            </div>

            <!-- Tabs -->
            <div class="flex border-b border-white/10 mb-2">
                <button type="button" id="tab-my-profile" onclick="switchTab('my-profile')"
                    class="px-6 py-3 text-[#2ecc71] border-b-2 border-[#2ecc71] font-medium transition-colors">
                    View Profile
                </button>
                <button type="button" id="tab-edit-profile" onclick="switchTab('edit-profile')"
                    class="px-6 py-3 text-gray-400 border-b-2 border-transparent hover:text-white font-medium transition-colors">
                    Edit Profile
                </button>
            </div>

            <!-- Content Area: My Profile View -->
            <div id="content-my-profile">
                <div
                    class="bg-[#1e1e2d] border border-white/10 rounded-lg p-4 mb-4 text-left text-white overflow-x-auto">
                    <table class="w-full text-sm">
                        <tbody class="divide-y divide-white/5">
                            <tr>
                                <td class="py-2 pr-4 font-medium text-white w-1/3">Full Name</td>
                                <td class="py-2 text-white">{{ user.get_full_name|default:'Not provided' }}</td>
                            </tr>
                            <tr>
                                <td class="py-2 pr-4 font-medium text-white">Email Address</td>
                                <td class="py-2 text-white">{{ user.email }}</td>
                            </tr>
                            <tr>
                                <td class="py-2 pr-4 font-medium text-white">Username</td>
                                <td class="py-2 text-white">@{{ user.username }}</td>
                            </tr>
                            <tr>
                                <td class="py-2 pr-4 font-medium text-white">Contact Number</td>
                                <td class="py-2 text-white">{{ user.profile.contact_number|default:'Not provided' }}
                                </td>
                            </tr>
                            <tr>
                                <td class="py-2 pr-4 font-medium text-white">Profession</td>
                                <td class="py-2 text-white">{{ user.profile.profession|default:'Not provided' }}</td>
                            </tr>
                            <tr>
                                <td class="py-2 pr-4 font-medium text-white">Interest Field</td>
                                <td class="py-2 text-white">{{ user.profile.interest_field|default:'Not provided' }}
                                </td>
                            </tr>
                            <tr>
                                <td class="py-2 pr-4 font-medium text-white">Highest Degree</td>
                                <td class="py-2 text-white">{{ user.profile.highest_degree|default:'Not provided' }}
                                </td>
                            </tr>
                            <tr>
                                <td class="py-2 pr-4 font-medium text-white">Location</td>
                                <td class="py-2 text-white">{{ user.profile.location|default:'Not provided' }}</td>
                            </tr>
                        </tbody>
                    </table>
                </div>

            </div>

            <!-- Content Area: Edit Profile View -->
            <div id="content-edit-profile" class="hidden">
                <div class="mb-3 flex flex-col md:flex-row gap-5">
                    <div class="w-full">
                        <label class="block text-sm font-medium text-white mb-2">Full Name</label>
                        <div class="relative">
                            <input type="text" name="full_name" value="{{ user.get_full_name }}"
                                class="w-full bg-[#1e1e2d] border border-white/10 rounded-lg py-1.5 px-3 text-white focus:outline-none focus:border-[#2ecc71] focus:ring-1 focus:ring-[#2ecc71] transition-colors placeholder:text-[12px] placeholder:italic"
                                placeholder="Enter your full name">
                        </div>
                    </div>
                    <div class="w-full">
                        <label class="block text-sm font-medium text-white mb-2">Email Address</label>
                        <div class="relative">
                            <input type="email" value="{{ user.email }}" disabled
                                class="w-full bg-[#1e1e2d] border border-white/10 rounded-lg py-1.5 px-3 text-white cursor-not-allowed">
                        </div>
                    </div>
                </div>

                <div class="mb-3 flex flex-col md:flex-row gap-5">
                    <div class="w-full">
                        <label class="block text-sm font-medium text-white mb-2">Username</label>
                        <div class="relative">
                            <input type="text" value="{{ user.username }}" disabled
                                class="w-full bg-[#1e1e2d] border border-white/10 rounded-lg py-1.5 px-3 text-white cursor-not-allowed">
                        </div>
                    </div>
                    <div class="w-full">
                        <label class="block text-sm font-medium text-white mb-2">Contact Number</label>
                        <div class="relative">
                            <input type="text" name="contact_number"
                                value="{{ profile.contact_number|default_if_none:'' }}"
                                class="w-full bg-[#1e1e2d] border border-white/10 rounded-lg py-1.5 px-3 text-white focus:outline-none focus:border-[#2ecc71] focus:ring-1 focus:ring-[#2ecc71] transition-colors placeholder:text-[12px] placeholder:italic"
                                placeholder="Contact Number">
                        </div>
                    </div>
                </div>

                <div class="mb-3 flex flex-col md:flex-row gap-5">
                    <div class="w-full">
                        <label class="block text-sm font-medium text-white mb-2">Profession</label>
                        <div class="relative">
                            <input type="text" name="profession" value="{{ profile.profession|default_if_none:'' }}"
                                class="w-full bg-[#1e1e2d] border border-white/10 rounded-lg py-1.5 px-3 text-white focus:outline-none focus:border-[#2ecc71] focus:ring-1 focus:ring-[#2ecc71] transition-colors placeholder:text-[12px] placeholder:italic"
                                placeholder="Profession">
                        </div>
                    </div>
                    <div class="w-full">
                        <label class="block text-sm font-medium text-white mb-2">Interest Field</label>
                        <div class="relative">
                            <input type="text" name="interest_field"
                                value="{{ profile.interest_field|default_if_none:'' }}"
                                class="w-full bg-[#1e1e2d] border border-white/10 rounded-lg py-1.5 px-3 text-white focus:outline-none focus:border-[#2ecc71] focus:ring-1 focus:ring-[#2ecc71] transition-colors placeholder:text-[12px] placeholder:italic"
                                placeholder="e.g. Science, Technology...">
                        </div>
                    </div>
                </div>

                <div class="mb-3 flex flex-col md:flex-row gap-5">
                    <div class="w-full">
                        <label class="block text-sm font-medium text-white mb-2">Educational Qualification</label>
                        <div class="relative">
                            <input type="text" name="highest_degree"
                                value="{{ profile.highest_degree|default_if_none:'' }}"
                                class="w-full bg-[#1e1e2d] border border-white/10 rounded-lg py-1.5 px-3 text-white focus:outline-none focus:border-[#2ecc71] focus:ring-1 focus:ring-[#2ecc71] transition-colors placeholder:text-[12px] placeholder:italic"
                                placeholder="Higher Degree">
                        </div>
                    </div>
                    <div class="w-full">
                        <label class="block text-sm font-medium text-white mb-2">Location</label>
                        <div class="relative">
                            <input type="text" name="location" value="{{ profile.location|default_if_none:'' }}"
                                class="w-full bg-[#1e1e2d] border border-white/10 rounded-lg py-1.5 px-3 text-white focus:outline-none focus:border-[#2ecc71] focus:ring-1 focus:ring-[#2ecc71] transition-colors placeholder:text-[12px] placeholder:italic"
                                placeholder="Hometown, Country">
                        </div>
                    </div>
                </div>

                <div class="flex justify-end mt-2">
                    <button type="submit"
                        class="px-6 py-2 bg-gradient-to-r from-[#2ecc71] to-[#27ae60] text-white font-medium text-sm rounded-lg hover:shadow-[0_0_15px_rgba(46,204,113,0.4)] transition-all flex items-center gap-2">
                        <i class="fas fa-save"></i> Save Changes
                    </button>
                </div>


            </div>
        </form>
        <div class="mt-4 border-t border-white/10 pt-2 flex justify-center">
            <a href="{% url 'home' %}#blog"
                class="px-4 py-2 rounded-full border border-white/20 bg-transparent text-white text-xs font-medium hover:border-[#00a8ff] hover:text-[#00a8ff] transition-all duration-300 flex items-center gap-2 shadow-sm hover:shadow-[0_0_15px_rgba(0,168,255,0.4)] group">
                <i class="fas fa-arrow-left group-hover:-translate-x-1 transition-transform"></i> Home
            </a>
        </div>
    </div>
</div>

<script>
    function switchTab(tabId) {
        const myProfileTab = document.getElementById('tab-my-profile');
        const editProfileTab = document.getElementById('tab-edit-profile');

        const myProfileContent = document.getElementById('content-my-profile');
        const editProfileContent = document.getElementById('content-edit-profile');

        if (tabId === 'my-profile') {
            myProfileContent.classList.remove('hidden');
            editProfileContent.classList.add('hidden');

            myProfileTab.classList.remove('text-gray-400', 'border-transparent', 'hover:text-white');
            myProfileTab.classList.add('text-[#2ecc71]', 'border-[#2ecc71]');

            editProfileTab.classList.remove('text-[#2ecc71]', 'border-[#2ecc71]');
            editProfileTab.classList.add('text-gray-400', 'border-transparent', 'hover:text-white');
        } else if (tabId === 'edit-profile') {
            editProfileContent.classList.remove('hidden');
            myProfileContent.classList.add('hidden');

            editProfileTab.classList.remove('text-gray-400', 'border-transparent', 'hover:text-white');
            editProfileTab.classList.add('text-[#2ecc71]', 'border-[#2ecc71]');

            myProfileTab.classList.remove('text-[#2ecc71]', 'border-[#2ecc71]');
            myProfileTab.classList.add('text-gray-400', 'border-transparent', 'hover:text-white');
        }
    }

    function previewImage(input) {
        if (input.files && input.files[0]) {
            const file = input.files[0];
            const reader = new FileReader();

            reader.onload = function (e) {
                const img = input.closest('.group').querySelector('img');
                if (img) {
                    img.src = e.target.result;
                } else {
                    const container = input.closest('.group');
                    const firstChild = container.firstElementChild;
                    if (firstChild.tagName !== 'IMG') {
                        const newImg = document.createElement('img');
                        newImg.src = e.target.result;
                        newImg.className = "w-24 h-24 rounded-full object-cover border-4 border-[#2ecc71]/50 group-hover:border-[#2ecc71] transition-colors";
                        container.insertBefore(newImg, firstChild);
                        firstChild.remove();
                    }
                }

                switchTab('edit-profile');
            }
            reader.readAsDataURL(file);
        }
    }
</script>
{% endblock %}