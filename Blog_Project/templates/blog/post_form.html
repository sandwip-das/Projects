{% extends 'base.html' %}
{% load static %}
{% block content %}
<div class="container my-5">
    <div class="row justify-content-center">
        <div class="col-md-8">
            <div class="card border-0 shadow-lg">
                <div class="card-body p-5">
                    <h2 class="mb-4 text-gradient fw-bold">{% if object %}Edit Post{% else %}Create New Post{% endif %}
                    </h2>
                    <form method="POST" enctype="multipart/form-data">
                        {% csrf_token %}
                        <!-- Manual Rendering for styling -->
                        {% for field in form %}
                        <div class="mb-3">
                            <label class="form-label fw-bold small text-muted">{{ field.label }}</label>
                            {{ field }}
                            {% if field.help_text %}
                            <small class="form-text text-muted">{{ field.help_text }}</small>
                            {% endif %}
                            {% for error in field.errors %}
                            <div class="text-danger small mt-1">{{ error }}</div>
                            {% endfor %}
                        </div>
                        {% endfor %}

                        <div class="d-grid gap-2 mt-4">
                            <button class="btn btn-primary rounded-pill py-2 fw-bold" type="submit">
                                {% if object %}Update Post{% else %}Publish Post{% endif %}
                            </button>
                            <a href="{% url 'home' %}" class="btn btn-outline-secondary rounded-pill py-2">Cancel</a>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- CKEditor Integration -->
<script src="https://cdn.ckeditor.com/ckeditor5/41.1.0/classic/ckeditor.js"></script>
<style>
    .ck-editor__editable {
        min-height: 300px;
        color: var(--text) !important;
        background-color: var(--card-bg) !important;
    }

    /* Dark Mode Overrides for CKEditor */
    [data-theme="dark"] .ck-toolbar {
        background-color: #1e293b !important;
        border-color: #334155 !important;
    }

    [data-theme="dark"] .ck-content {
        background-color: #0f172a !important;
        color: #ffffff !important;
    }

    [data-theme="dark"] .ck.ck-editor__main>.ck-editor__editable:not(.ck-focused) {
        border-color: #334155 !important;
    }

    [data-theme="dark"] .ck.ck-button,
    [data-theme="dark"] .ck.ck-dropdown__button,
    [data-theme="dark"] .ck.ck-dialog,
    [data-theme="dark"] .ck.ck-input-text {
        color: #e2e8f0 !important;
        background: #1e293b !important;
    }

    [data-theme="dark"] .ck-powered-by {
        display: none !important;
    }
</style>
<script>
    document.addEventListener("DOMContentLoaded", function () {
        const contentField = document.querySelector('#post-content');
        if (contentField) {
            ClassicEditor
                .create(contentField, {
                    toolbar: ['heading', '|', 'bold', 'italic', 'link', 'bulletedList', 'numberedList', 'blockQuote', 'undo', 'redo'],
                    heading: {
                        options: [
                            { model: 'paragraph', title: 'Paragraph', class: 'ck-heading_paragraph' },
                            { model: 'heading2', view: 'h2', title: 'Heading 2', class: 'ck-heading_heading2' },
                            { model: 'heading3', view: 'h3', title: 'Heading 3', class: 'ck-heading_heading3' }
                        ]
                    }
                })
                .then(editor => {
                    console.log('Editor was initialized', editor);
                })
                .catch(error => {
                    console.error(error);
                });
        }
    });
</script>
{% endblock %}